import{a0 as F,r as n,j as e,ah as P,ai as A,x as E,L as I,af as _,I as O,G as R,ae as T,t as B}from"./vendor-react-BtnKiOrb.js";import{A as j,a as w,b as G}from"./alert-wYC2wlrk.js";import{d as H,B as m}from"./index-B87L8flj.js";import{C as U,b as q,c as z,d as W,a as J}from"./card-DaWziHEX.js";import{I as y}from"./input-fipynuSj.js";import{L as N}from"./label-C7siTT_u.js";function Z(){const a=F(),{login:b}=H(),[h,v]=n.useState(""),[x,S]=n.useState(""),[c,k]=n.useState(!1),[d,u]=n.useState(!1),[C,L]=n.useState(!0),[f,i]=n.useState(null);n.useEffect(()=>{(async()=>{try{if((await(await fetch("/auth/check-setup",{credentials:"include"})).json()).needs_setup){a("/setup",{replace:!0});return}const r=await fetch("/auth/session-status",{credentials:"include"});if(r.ok){const s=await r.json();if(s.status==="success"&&s.logged_in&&s.broker){a("/dashboard",{replace:!0});return}else if(s.status==="success"&&s.authenticated&&!s.logged_in){a("/broker",{replace:!0});return}}}catch(t){console.error("Failed to check setup status:",t)}finally{L(!1)}})()},[a]);const D=async l=>{l.preventDefault(),u(!0),i(null);try{const t=await fetch("/auth/csrf-token",{credentials:"include"});if(!t.ok){console.error("CSRF fetch failed:",t.status,t.statusText),i("Failed to initialize login. Please refresh the page."),u(!1);return}const g=await t.json(),r=new FormData;r.append("username",h),r.append("password",x),r.append("csrf_token",g.csrf_token);const s=await fetch("/auth/login",{method:"POST",body:r,credentials:"include"}),p=s.headers.get("content-type");if(!p||!p.includes("application/json")){console.error("Login response is not JSON:",p),s.url.includes("/setup")?(i("Please complete initial setup first."),a("/setup")):i("Login failed. Please try again."),u(!1);return}const o=await s.json();o.status==="error"?(i(o.message||"Login failed. Please try again."),o.redirect&&a(o.redirect)):(b(h,""),B.success("Login successful"),a(o.redirect||"/broker"))}catch(t){console.error("Login error:",t),i("Login failed. Please try again.")}finally{u(!1)}};return C?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center py-8 px-4",children:e.jsx("div",{className:"container max-w-6xl",children:e.jsxs("div",{className:"flex flex-col lg:flex-row items-center justify-between gap-8 lg:gap-16",children:[e.jsxs(U,{className:"w-full max-w-md order-1 lg:order-2 shadow-xl",children:[e.jsxs(q,{className:"text-center",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("img",{src:"/logo.png",alt:"OpenAlgo",className:"h-20 w-20"})}),e.jsx(z,{className:"text-2xl",children:"Welcome Back"}),e.jsx(W,{children:"Sign in to your OpenAlgo account"})]}),e.jsx(J,{children:e.jsxs("form",{onSubmit:D,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"username",children:"Username"}),e.jsx(y,{id:"username",type:"text",placeholder:"Enter your username",value:h,onChange:l=>v(l.target.value),required:!0,disabled:d,autoComplete:"username"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"password",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(y,{id:"password",type:c?"text":"password",placeholder:"Enter your password",value:x,onChange:l=>S(l.target.value),required:!0,disabled:d,autoComplete:"current-password",className:"pr-10"}),e.jsx(m,{type:"button",variant:"ghost",size:"icon",className:"absolute right-0 top-0 h-full px-3 hover:bg-transparent",onClick:()=>k(!c),"aria-label":c?"Hide password":"Show password",children:c?e.jsx(P,{className:"h-4 w-4 text-muted-foreground"}):e.jsx(A,{className:"h-4 w-4 text-muted-foreground"})})]}),e.jsx("div",{className:"text-right",children:e.jsx(E,{to:"/reset-password",className:"text-sm text-muted-foreground hover:text-primary",children:"Forgot password?"})})]}),f&&e.jsx(j,{variant:"destructive",children:e.jsx(w,{children:f})}),e.jsx(m,{type:"submit",className:"w-full",disabled:d,children:d?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"mr-2 h-4 w-4 animate-spin"}),"Signing in..."]}):e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"mr-2 h-4 w-4"}),"Sign in"]})})]})})]}),e.jsxs("div",{className:"flex-1 max-w-xl text-center lg:text-left order-2 lg:order-1",children:[e.jsxs("h1",{className:"text-4xl lg:text-5xl font-bold mb-6",children:["Welcome to ",e.jsx("span",{className:"text-primary",children:"OpenAlgo"})]}),e.jsx("p",{className:"text-lg lg:text-xl mb-8 text-muted-foreground",children:"Sign in to your account to access your trading dashboard and manage your algorithmic trading strategies."}),e.jsxs(j,{className:"mb-6",children:[e.jsx(O,{className:"h-4 w-4"}),e.jsx(G,{children:"First Time User?"}),e.jsx(w,{children:"Contact your administrator to set up your account."})]}),e.jsxs("div",{className:"flex justify-center lg:justify-start gap-4",children:[e.jsx(m,{variant:"outline",asChild:!0,children:e.jsxs("a",{href:"https://github.com/marketcalls/openalgo",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-5 w-5"}),"GitHub"]})}),e.jsx(m,{variant:"outline",asChild:!0,children:e.jsxs("a",{href:"https://openalgo.in/discord",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2",children:[e.jsx(T,{className:"h-5 w-5"}),"Discord"]})})]})]})]})})})}export{Z as default};
