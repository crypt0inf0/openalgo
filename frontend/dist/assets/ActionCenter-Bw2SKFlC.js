import{r as n,t as r,l as ae,j as e,I as te,x as C,ap as re,aL as ne,au as N,ag as L,v as le,aM as ie,aN as ce,aO as de,az as oe,Z as xe,aP as he}from"./vendor-react-BtnKiOrb.js";import{w as j,B as p,e as d}from"./index-B87L8flj.js";import{A as me,b as pe,a as ue}from"./alert-wYC2wlrk.js";import{A as ge,b as je,c as fe,d as ve,e as Ne,f as ye,g as we,h as be}from"./alert-dialog-CN_Rec7D.js";import{C as u,a as g,b as _e,c as Ae,d as Ce}from"./card-DaWziHEX.js";import{C as Se,a as Te}from"./collapsible-BCcK3_bH.js";import{T as De,a as Oe,b as y,c as o,d as Re,e as c}from"./table-CWVmNM6U.js";import{T as ke,a as Fe,b as w}from"./tabs-CKR5z49l.js";function He(){const[b,z]=n.useState([]),[l,H]=n.useState({total_pending:0,total_approved:0,total_rejected:0,total_buy_orders:0,total_sell_orders:0}),[U,Y]=n.useState(!0),[S,T]=n.useState(!1),[m,q]=n.useState("pending"),[D,K]=n.useState(new Set),[_,A]=n.useState(null),[O,R]=n.useState(!1),[k,F]=n.useState(null),[$,E]=n.useState(null),[B,I]=n.useState(!1),P=n.useRef(null),f=n.useRef(null),i=n.useCallback(async()=>{try{const s=m==="all"?"":m,a=await j.get(`/action-center/api/data${s?`?status=${s}`:""}`);a.data.status==="success"&&(z(Array.isArray(a.data.data.orders)?a.data.data.orders:[]),H(a.data.data.statistics||{total_pending:0,total_approved:0,total_rejected:0,total_buy_orders:0,total_sell_orders:0}))}catch(s){console.error("Error fetching action center data:",s),r.error("Failed to load action center data")}finally{Y(!1),T(!1)}},[m]);n.useEffect(()=>{if(i(),m==="pending"){const s=setInterval(i,3e4);return()=>clearInterval(s)}},[i,m]),n.useEffect(()=>{f.current=new Audio("/sounds/alert.mp3"),f.current.preload="auto";const s=window.location.protocol,a=window.location.hostname,t=window.location.port;P.current=ae(`${s}//${a}:${t}`,{transports:["websocket","polling"]});const h=P.current;return h.on("pending_order_created",x=>{f.current&&f.current.play().catch(()=>{}),r.warning(`New Order Queued: ${x.message}`,{duration:5e3}),i()}),h.on("pending_order_updated",()=>{i()}),()=>{h.disconnect()}},[i]);const V=async()=>{T(!0),await i(),r.success("Data refreshed")},J=async s=>{F(s);try{const a=await j.post(`/action-center/approve/${s}`,{});a.data.status==="success"?(r.success(a.data.message||"Order approved and executed"),i()):a.data.status==="warning"?(r.warning(a.data.message),i()):r.error(a.data.message||"Failed to approve order")}catch(a){const t=a;r.error(t.response?.data?.message||"Failed to approve order")}finally{F(null)}},Q=async s=>{E(s);try{const a=await j.post(`/action-center/reject/${s}`,{reason:"Rejected by user"});a.data.status==="success"?(r.success("Order rejected"),i()):r.error(a.data.message||"Failed to reject order")}catch(a){const t=a;r.error(t.response?.data?.message||"Failed to reject order")}finally{E(null)}},W=async()=>{if(_){R(!0);try{const s=await j.delete(`/action-center/delete/${_.id}`);s.data.status==="success"?(r.success("Order deleted"),A(null),i()):r.error(s.data.message||"Failed to delete order")}catch(s){const a=s;r.error(a.response?.data?.message||"Failed to delete order")}finally{R(!1)}}},X=async()=>{I(!0);try{const s=await j.post("/action-center/approve-all",{});s.data.status==="success"?(r.success(s.data.message||"All orders approved"),i()):s.data.status==="warning"?(r.warning(s.data.message),i()):r.error(s.data.message||"Failed to approve all orders")}catch(s){const a=s;r.error(a.response?.data?.message||"Failed to approve all orders")}finally{I(!1)}},Z=s=>{K(a=>{const t=new Set(a);return t.has(s)?t.delete(s):t.add(s),t})},G=s=>{switch(s){case"NSE":return"default";case"NFO":return"secondary";default:return"outline"}},ee=s=>{switch(s){case"MARKET":return"default";case"LIMIT":return"secondary";case"SL":case"SL-M":return"destructive";default:return"outline"}},se=s=>{if(!s)return"";try{const a=new Date(s.replace(" IST","")),h=new Date().getTime()-a.getTime(),x=Math.floor(h/6e4);if(x<1)return"Just now";if(x===1)return"1 minute ago";if(x<60)return`${x} minutes ago`;const v=Math.floor(x/60);if(v===1)return"1 hour ago";if(v<24)return`${v} hours ago`;const M=Math.floor(v/24);return M===1?"Yesterday":`${M} days ago`}catch{return""}};return U?e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsxs("div",{className:"py-6 space-y-6",children:[e.jsxs(me,{children:[e.jsx(te,{className:"h-4 w-4"}),e.jsx(pe,{children:"OpenAlgo Action Center"}),e.jsx(ue,{children:"Centralized hub for managing semi-automated trading orders. When Semi-Auto mode is enabled in API Key settings, all incoming orders are queued here for manual approval before broker execution."})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(C,{to:"/dashboard",className:"text-muted-foreground hover:text-foreground",children:e.jsx(re,{className:"h-4 w-4"})}),e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(ne,{className:"h-6 w-6"}),"Action Center"]})]}),e.jsx("p",{className:"text-muted-foreground",children:"Review and manage pending orders"})]}),e.jsxs("div",{className:"flex gap-2",children:[m==="pending"&&l.total_pending>0&&e.jsxs(p,{variant:"default",className:"bg-green-500 hover:bg-green-600",onClick:X,disabled:B,children:[B?e.jsx(N,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(L,{className:"h-4 w-4 mr-2"}),"Approve All (",l.total_pending,")"]}),e.jsxs(p,{variant:"outline",onClick:V,disabled:S,children:[e.jsx(N,{className:`h-4 w-4 mr-2 ${S?"animate-spin":""}`}),"Refresh"]}),e.jsx(C,{to:"/apikey",children:e.jsxs(p,{variant:"outline",children:[e.jsx(le,{className:"h-4 w-4 mr-2"}),"Toggle Order Mode"]})})]})]}),e.jsx(ke,{value:m,onValueChange:s=>q(s),children:e.jsxs(Fe,{children:[e.jsxs(w,{value:"pending",className:"relative",children:["Pending",l.total_pending>0&&e.jsx(d,{variant:"destructive",className:"ml-2 animate-pulse",children:l.total_pending})]}),e.jsxs(w,{value:"approved",children:["Approved",l.total_approved>0&&e.jsx(d,{variant:"secondary",className:"ml-2 bg-green-500",children:l.total_approved})]}),e.jsxs(w,{value:"rejected",children:["Rejected",l.total_rejected>0&&e.jsx(d,{variant:"destructive",className:"ml-2",children:l.total_rejected})]}),e.jsx(w,{value:"all",children:"All Orders"})]})}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-5 gap-4",children:[e.jsx(u,{children:e.jsxs(g,{className:"p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-yellow-500",children:l.total_pending}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Pending Approval"})]})}),e.jsx(u,{children:e.jsxs(g,{className:"p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-green-500",children:l.total_buy_orders}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Buy Orders"})]})}),e.jsx(u,{children:e.jsxs(g,{className:"p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-red-500",children:l.total_sell_orders}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Sell Orders"})]})}),e.jsx(u,{children:e.jsxs(g,{className:"p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-green-500",children:l.total_approved}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Approved"})]})}),e.jsx(u,{children:e.jsxs(g,{className:"p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-red-500",children:l.total_rejected}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Rejected"})]})})]}),e.jsxs(u,{children:[e.jsxs(_e,{children:[e.jsx(Ae,{children:"Orders"}),e.jsxs(Ce,{children:[b.length," orders"]})]}),e.jsx(g,{children:e.jsx("div",{className:"border rounded-md",children:e.jsxs(De,{children:[e.jsx(Oe,{children:e.jsxs(y,{children:[e.jsx(o,{children:"Strategy"}),e.jsx(o,{children:"Symbol"}),e.jsx(o,{children:"Exchange"}),e.jsx(o,{children:"Action"}),e.jsx(o,{className:"text-right",children:"Quantity"}),e.jsx(o,{className:"text-right",children:"Price"}),e.jsx(o,{children:"Order Type"}),e.jsx(o,{children:"Product"}),e.jsx(o,{children:"Created"}),e.jsx(o,{children:"Actions"})]})}),e.jsx(Re,{children:b.length===0?e.jsx(y,{children:e.jsx(c,{colSpan:10,className:"text-center text-muted-foreground py-8",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{children:"No orders found"}),e.jsxs("p",{className:"text-sm",children:["Enable Semi-Auto mode in"," ",e.jsx(C,{to:"/apikey",className:"text-primary hover:underline",children:"API Key settings"})," ","to queue orders here"]})]})})}):b.map(s=>e.jsxs(e.Fragment,{children:[e.jsxs(y,{children:[e.jsxs(c,{children:[e.jsx(d,{variant:"outline",children:s.strategy}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:s.api_type})]}),e.jsx(c,{className:"font-medium",children:s.symbol}),e.jsx(c,{children:e.jsx(d,{variant:G(s.exchange),children:s.exchange})}),e.jsx(c,{children:e.jsxs(d,{className:`gap-1 ${s.action==="BUY"?"bg-green-500 hover:bg-green-600":"bg-red-500 hover:bg-red-600"}`,children:[s.action==="BUY"?e.jsx(ie,{className:"h-3 w-3"}):e.jsx(ce,{className:"h-3 w-3"}),s.action]})}),e.jsx(c,{className:"text-right font-mono",children:s.quantity}),e.jsx(c,{className:"text-right font-mono",children:s.price||0}),e.jsx(c,{children:e.jsx(d,{variant:ee(s.price_type),children:s.price_type})}),e.jsx(c,{children:e.jsx(d,{variant:"secondary",children:s.product_type})}),e.jsxs(c,{children:[e.jsx("div",{className:"text-sm font-mono",children:s.created_at_ist}),e.jsx("div",{className:"text-xs text-muted-foreground",children:se(s.created_at_ist)})]}),e.jsx(c,{children:e.jsxs("div",{className:"flex gap-1 flex-wrap",children:[e.jsx(p,{size:"icon",variant:"ghost",className:"h-8 w-8",onClick:()=>Z(s.id),children:D.has(s.id)?e.jsx(de,{className:"h-4 w-4"}):e.jsx(oe,{className:"h-4 w-4"})}),s.status==="pending"?e.jsxs(e.Fragment,{children:[e.jsx(p,{size:"sm",className:"bg-green-500 hover:bg-green-600 h-8",onClick:()=>J(s.id),disabled:k===s.id,children:k===s.id?e.jsx(N,{className:"h-4 w-4 animate-spin"}):e.jsx(L,{className:"h-4 w-4"})}),e.jsx(p,{size:"sm",variant:"destructive",className:"h-8",onClick:()=>Q(s.id),disabled:$===s.id,children:$===s.id?e.jsx(N,{className:"h-4 w-4 animate-spin"}):e.jsx(xe,{className:"h-4 w-4"})})]}):e.jsx(p,{size:"sm",variant:"ghost",className:"h-8 text-destructive hover:text-destructive",onClick:()=>A(s),children:e.jsx(he,{className:"h-4 w-4"})})]})})]},s.id),D.has(s.id)&&e.jsx(y,{children:e.jsx(c,{colSpan:10,className:"bg-muted/50 p-4",children:e.jsx(Se,{open:!0,children:e.jsx(Te,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold",children:"Order Details"}),s.api_type==="basketorder"&&s.raw_order_data.orders?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Basket Order with"," ",Array.isArray(s.raw_order_data.orders)?s.raw_order_data.orders.length:0," ","orders"]}),Array.isArray(s.raw_order_data.orders)&&s.raw_order_data.orders.map((a,t)=>e.jsx(u,{children:e.jsxs(g,{className:"p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs(d,{variant:"outline",children:["Order ",t+1]}),e.jsx("span",{className:"font-medium",children:String(a.symbol||"")}),e.jsx(d,{className:a.action==="BUY"?"bg-green-500":"bg-red-500",children:String(a.action||"")})]}),e.jsx("div",{className:"grid grid-cols-4 gap-2 text-sm",children:Object.entries(a).map(([h,x])=>e.jsxs("div",{children:[e.jsxs("span",{className:"text-muted-foreground",children:[h,":"]})," ",e.jsx("span",{className:"font-medium",children:String(x)})]},h))})]})},t))]}):e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:Object.entries(s.raw_order_data).map(([a,t])=>e.jsxs("div",{className:"bg-background rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-muted-foreground uppercase",children:a}),e.jsx("p",{className:"font-medium break-all",children:typeof t=="object"?JSON.stringify(t,null,2):String(t)})]},a))})]})})})})})]}))})]})})})]}),e.jsx(ge,{open:!!_,onOpenChange:()=>A(null),children:e.jsxs(je,{children:[e.jsxs(fe,{children:[e.jsx(ve,{children:"Delete Order?"}),e.jsx(Ne,{children:"Are you sure you want to delete this order? This action cannot be undone."})]}),e.jsxs(ye,{children:[e.jsx(we,{children:"Cancel"}),e.jsx(be,{onClick:W,disabled:O,children:O?"Deleting...":"Delete"})]})]})})]})}export{He as default};
