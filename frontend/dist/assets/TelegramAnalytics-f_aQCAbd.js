import{r as g,t as L,j as e,x as w,ap as U,q as S,b6 as $,B,M as D,k as E}from"./vendor-react-BtnKiOrb.js";import{w as M,e as d}from"./index-B87L8flj.js";import{C as r,a as t,b as f,c as p,d as N}from"./card-DaWziHEX.js";import{T as k,a as H,b as y,c as i,d as R,e as n}from"./table-CWVmNM6U.js";function J(){const[a,A]=g.useState(null),[C,_]=g.useState(!0);g.useEffect(()=>{T()},[]);const T=async()=>{try{const s=await M.get("/telegram/api/analytics");A(s.data.data)}catch(s){console.error("Error fetching analytics:",s),L.error("Failed to load analytics")}finally{_(!1)}},m=s=>Array.isArray(s)?s.reduce((x,h)=>x+h.count,0):0,v=s=>!Array.isArray(s)||s.length===0?null:s.reduce((x,h)=>h.count>x.count?h:x,s[0]),b=s=>s?new Date(s).toLocaleString():"-";if(C)return e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})});if(!a)return e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx("p",{className:"text-muted-foreground",children:"Failed to load analytics data"})});const l=Array.isArray(a.stats_7d)?a.stats_7d:[],c=Array.isArray(a.stats_30d)?a.stats_30d:[],o=Array.isArray(a.users)?a.users:[],j=v(l),u=v(c);return e.jsxs("div",{className:"py-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(w,{to:"/telegram",className:"text-muted-foreground hover:text-foreground",children:e.jsx(U,{className:"h-4 w-4"})}),e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(S,{className:"h-6 w-6"}),"Bot Analytics"]})]}),e.jsx("p",{className:"text-muted-foreground",children:"View usage statistics and trends for your Telegram bot"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(r,{children:e.jsx(t,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-500 flex items-center justify-center",children:e.jsx($,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:a.total_users}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Users"})]})]})})}),e.jsx(r,{children:e.jsx(t,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-green-500 flex items-center justify-center",children:e.jsx(B,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:a.active_users}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Active Users"})]})]})})}),e.jsx(r,{children:e.jsx(t,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-500 flex items-center justify-center",children:e.jsx(D,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:m(l)}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Commands (7d)"})]})]})})}),e.jsx(r,{children:e.jsx(t,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-orange-500 flex items-center justify-center",children:e.jsx(E,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:m(c)}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Commands (30d)"})]})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(r,{children:[e.jsxs(f,{children:[e.jsx(p,{children:"Last 7 Days"}),e.jsx(N,{children:j?`Most used: /${j.command} (${j.count} times)`:"No commands recorded"})]}),e.jsx(t,{children:l.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No command data for the last 7 days"}):e.jsx("div",{className:"space-y-3",children:l.map(s=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(d,{variant:"outline",children:["/",s.command]})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-32 bg-muted rounded-full h-2",children:e.jsx("div",{className:"bg-primary h-2 rounded-full",style:{width:`${s.count/m(l)*100}%`}})}),e.jsx("span",{className:"text-sm font-medium w-12 text-right",children:s.count})]})]},s.command))})})]}),e.jsxs(r,{children:[e.jsxs(f,{children:[e.jsx(p,{children:"Last 30 Days"}),e.jsx(N,{children:u?`Most used: /${u.command} (${u.count} times)`:"No commands recorded"})]}),e.jsx(t,{children:c.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No command data for the last 30 days"}):e.jsx("div",{className:"space-y-3",children:c.map(s=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(d,{variant:"outline",children:["/",s.command]})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-32 bg-muted rounded-full h-2",children:e.jsx("div",{className:"bg-primary h-2 rounded-full",style:{width:`${s.count/m(c)*100}%`}})}),e.jsx("span",{className:"text-sm font-medium w-12 text-right",children:s.count})]})]},s.command))})})]})]}),e.jsxs(r,{children:[e.jsxs(f,{children:[e.jsx(p,{children:"User Activity"}),e.jsx(N,{children:"Recent user activity overview"})]}),e.jsxs(t,{children:[e.jsx("div",{className:"border rounded-md",children:e.jsxs(k,{children:[e.jsx(H,{children:e.jsxs(y,{children:[e.jsx(i,{children:"User"}),e.jsx(i,{children:"OpenAlgo Account"}),e.jsx(i,{children:"Status"}),e.jsx(i,{children:"Joined"}),e.jsx(i,{children:"Last Active"})]})}),e.jsx(R,{children:o.length===0?e.jsx(y,{children:e.jsx(n,{colSpan:5,className:"text-center text-muted-foreground py-8",children:"No users registered yet"})}):o.slice(0,10).map(s=>e.jsxs(y,{children:[e.jsx(n,{children:e.jsx("div",{children:e.jsx("p",{className:"font-medium",children:s.telegram_username?`@${s.telegram_username}`:s.first_name||"Unknown"})})}),e.jsx(n,{children:s.openalgo_username?e.jsx(d,{variant:"outline",children:s.openalgo_username}):e.jsx("span",{className:"text-muted-foreground",children:"-"})}),e.jsx(n,{children:s.notifications_enabled?e.jsx(d,{className:"bg-green-500 hover:bg-green-600",children:"Active"}):e.jsx(d,{variant:"secondary",children:"Inactive"})}),e.jsx(n,{className:"text-sm",children:b(s.created_at)}),e.jsx(n,{className:"text-sm",children:b(s.last_active)})]},s.telegram_id))})]})}),o.length>10&&e.jsx("div",{className:"mt-4 text-center",children:e.jsxs(w,{to:"/telegram/users",className:"text-sm text-primary hover:underline",children:["View all ",o.length," users"]})})]})]})]})}export{J as default};
