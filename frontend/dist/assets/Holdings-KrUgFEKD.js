import{r as l,j as e,au as V,ad as z,k as T,aA as S,L as A}from"./vendor-react-BtnKiOrb.js";import{t as U}from"./trading-B9xVcn7A.js";import{d as q,o as O,B as L,c as m,e as P,s as o}from"./index-B87L8flj.js";import{C as h,b as u,d as j,c as f,a as Q}from"./card-DaWziHEX.js";import{T as K,a as M,b as I,c as d,d as _,e as x}from"./table-CWVmNM6U.js";function p(n){return new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:2}).format(n)}function E(n){return`${n>=0?"+":""}${n.toFixed(2)}%`}function Z(){const{apiKey:n}=q(),[g,R]=l.useState([]),[t,H]=l.useState(null),[k,b]=l.useState(!0),[v,w]=l.useState(!1),[C,N]=l.useState(null),c=l.useCallback(async(s=!1)=>{if(!n){b(!1);return}s&&w(!0);try{const a=await U.getHoldings(n);a.status==="success"&&a.data?(R(a.data.holdings||[]),H(a.data.statistics),N(null)):N(a.message||"Failed to fetch holdings")}catch{N("Failed to fetch holdings")}finally{b(!1),w(!1)}},[n]);l.useEffect(()=>{c();const s=setInterval(()=>c(),3e4);return()=>clearInterval(s)},[c]),l.useEffect(()=>{const s=O(()=>{c()});return()=>s()},[c]);const $=()=>{const s=["Symbol","Exchange","Quantity","Product","P&L","P&L %"],a=g.map(r=>[o(r.symbol),o(r.exchange),o(r.quantity),o(r.product),o(r.pnl),o(r.pnlpercent)]),B=[s,...a].map(r=>r.join(",")).join(`
`),D=new Blob([B],{type:"text/csv"}),F=URL.createObjectURL(D),y=document.createElement("a");y.href=F,y.download=`holdings_${new Date().toISOString().split("T")[0]}.csv`,y.click()},i=s=>s>=0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Investor Summary"}),e.jsx("p",{className:"text-muted-foreground",children:"View your holdings portfolio"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(L,{variant:"outline",size:"sm",onClick:()=>c(!0),disabled:v,children:[e.jsx(V,{className:m("h-4 w-4 mr-2",v&&"animate-spin")}),"Refresh"]}),e.jsxs(L,{variant:"outline",size:"sm",onClick:$,children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Export"]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsx(h,{children:e.jsxs(u,{className:"pb-2",children:[e.jsx(j,{children:"Total Holding Value"}),e.jsx(f,{className:"text-2xl text-primary",children:t?p(t.totalholdingvalue):"---"})]})}),e.jsx(h,{children:e.jsxs(u,{className:"pb-2",children:[e.jsx(j,{children:"Total Investment Value"}),e.jsx(f,{className:"text-2xl",children:t?p(t.totalinvvalue):"---"})]})}),e.jsx(h,{children:e.jsxs(u,{className:"pb-2",children:[e.jsx(j,{children:"Total Profit and Loss"}),e.jsx(f,{className:m("text-2xl",t&&i(t.totalprofitandloss)?"text-green-600":"text-red-600"),children:t?e.jsxs("div",{className:"flex items-center gap-1",children:[i(t.totalprofitandloss)?e.jsx(T,{className:"h-5 w-5"}):e.jsx(S,{className:"h-5 w-5"}),p(t.totalprofitandloss)]}):"---"})]})}),e.jsx(h,{children:e.jsxs(u,{className:"pb-2",children:[e.jsx(j,{children:"Total PnL Percentage"}),e.jsx(f,{className:m("text-2xl",t&&i(t.totalpnlpercentage)?"text-green-600":"text-red-600"),children:t?E(t.totalpnlpercentage):"---"})]})})]}),e.jsx(h,{children:e.jsx(Q,{className:"p-0",children:k?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(A,{className:"h-8 w-8 animate-spin"})}):C?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:C}):g.length===0?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"No holdings found"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(K,{children:[e.jsx(M,{children:e.jsxs(I,{children:[e.jsx(d,{children:"Trading Symbol"}),e.jsx(d,{children:"Exchange"}),e.jsx(d,{className:"text-right",children:"Quantity"}),e.jsx(d,{children:"Product"}),e.jsx(d,{className:"text-right",children:"Profit and Loss"}),e.jsx(d,{className:"text-right",children:"PnL Percentage"})]})}),e.jsx(_,{children:g.map((s,a)=>e.jsxs(I,{children:[e.jsx(x,{className:"font-medium",children:s.symbol}),e.jsx(x,{children:e.jsx(P,{variant:"outline",children:s.exchange})}),e.jsx(x,{className:"text-right font-mono",children:s.quantity}),e.jsx(x,{children:e.jsx(P,{variant:"secondary",children:s.product})}),e.jsx(x,{className:m("text-right font-medium",i(s.pnl)?"text-green-600":"text-red-600"),children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[i(s.pnl)?e.jsx(T,{className:"h-4 w-4"}):e.jsx(S,{className:"h-4 w-4"}),p(s.pnl)]})}),e.jsx(x,{className:m("text-right",i(s.pnlpercent)?"text-green-600":"text-red-600"),children:E(s.pnlpercent)})]},`${s.symbol}-${s.exchange}-${a}`))})]})})})})]})}export{Z as default};
