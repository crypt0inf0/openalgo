import{r as m,t as o,j as e,v as b,x as O,q as M,a$ as S,b0 as x}from"./vendor-react-BtnKiOrb.js";import{A as z,a as P}from"./alert-wYC2wlrk.js";import{B as l}from"./index-B87L8flj.js";import{C as B,b as V,c as W,a as X}from"./card-DaWziHEX.js";import{D as q,b as H,c as U,d as Y,e as J,f as $}from"./dialog-B8y9YkxF.js";import{I as p}from"./input-fipynuSj.js";import{L as G}from"./label-C7siTT_u.js";import{S as w,a as k,b as _,c as y,d as T}from"./select-Dmte1kG2.js";async function L(){return(await(await fetch("/auth/csrf-token",{credentials:"include"})).json()).csrf_token}const Q=["Never","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],Z=[{value:"100000",label:"1,00,000 (1 Lakh)"},{value:"500000",label:"5,00,000 (5 Lakhs)"},{value:"1000000",label:"10,00,000 (10 Lakhs)"},{value:"2500000",label:"25,00,000 (25 Lakhs)"},{value:"5000000",label:"50,00,000 (50 Lakhs)"},{value:"10000000",label:"1,00,00,000 (1 Crore)"}];function K(i){return i.split("_").map(c=>{const h=c.toUpperCase();return["NSE","BSE","CDS","BCD","MCX","NCDEX","MIS","CNC","NRML"].includes(h)?h:c.charAt(0).toUpperCase()+c.slice(1)}).join(" ")}function ce(){const[i,c]=m.useState({}),[h,f]=m.useState(new Set),[R,F]=m.useState(!0),[v,C]=m.useState(!1),[D,j]=m.useState(!1);m.useEffect(()=>{g()},[]);const g=async()=>{try{const s=await fetch("/sandbox/api/configs",{credentials:"include"});if(s.ok){const r=await s.json();r.status==="success"&&c(r.configs)}}catch(s){console.error("Error fetching configs:",s),o.error("Failed to load configuration")}finally{F(!1)}},d=(s,r)=>{c(a=>{const t={...a};for(const n in t)if(t[n].configs[s]){t[n].configs[s]={...t[n].configs[s],value:r};break}return t}),f(a=>new Set(a).add(s))},u=async s=>{let r="";for(const a in i)if(i[a].configs[s]){r=i[a].configs[s].value;break}try{const a=await L(),n=await(await fetch("/sandbox/update",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":a},credentials:"include",body:JSON.stringify({config_key:s,config_value:r})})).json();n.status==="success"?(o.success(n.message),f(I=>{const N=new Set(I);return N.delete(s),N})):o.error(n.message)}catch(a){console.error("Error saving config:",a),o.error("Failed to save configuration")}},E=async()=>{C(!0);try{const s=await L(),a=await(await fetch("/sandbox/reset",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":s},credentials:"include"})).json();a.status==="success"?(o.success(a.message),j(!1),setTimeout(()=>{g()},1e3)):o.error(a.message)}catch(s){console.error("Error resetting config:",s),o.error("Failed to reset configuration")}finally{C(!1)}},A=(s,r)=>{const a=h.has(s);if(s==="reset_day")return e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(w,{value:r.value,onValueChange:t=>d(s,t),children:[e.jsx(k,{className:"flex-1",children:e.jsx(_,{})}),e.jsx(y,{children:Q.map(t=>e.jsx(T,{value:t,children:t},t))})]}),e.jsxs(l,{size:"sm",variant:a?"default":"secondary",onClick:()=>u(s),children:[e.jsx(x,{className:"h-4 w-4 mr-1"}),"Set"]})]});if(s==="reset_time"||s.endsWith("_square_off_time"))return e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{type:"time",value:r.value||"",onChange:t=>d(s,t.target.value),className:"flex-1"}),e.jsxs(l,{size:"sm",variant:a?"default":"secondary",onClick:()=>u(s),children:[e.jsx(x,{className:"h-4 w-4 mr-1"}),"Set"]})]});if(s.endsWith("_leverage"))return e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{type:"number",value:r.value||"",onChange:t=>d(s,t.target.value),min:"1",max:"50",step:"0.1",className:"flex-1"}),e.jsxs(l,{size:"sm",variant:a?"default":"secondary",onClick:()=>u(s),children:[e.jsx(x,{className:"h-4 w-4 mr-1"}),"Set"]})]});if(s==="starting_capital"){const t=parseFloat(r.value||"10000000").toFixed(0);return e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(w,{value:t,onValueChange:n=>d(s,n),children:[e.jsx(k,{className:"flex-1",children:e.jsx(_,{})}),e.jsx(y,{children:Z.map(n=>e.jsx(T,{value:n.value,children:n.label},n.value))})]}),e.jsxs(l,{size:"sm",variant:a?"default":"secondary",onClick:()=>u(s),children:[e.jsx(x,{className:"h-4 w-4 mr-1"}),"Set"]})]})}return s==="order_check_interval"||s==="mtm_update_interval"?e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{type:"number",value:r.value||"",onChange:t=>d(s,t.target.value),min:s==="mtm_update_interval"?0:1,max:s==="mtm_update_interval"?60:30,step:"1",className:"flex-1"}),e.jsxs(l,{size:"sm",variant:a?"default":"secondary",onClick:()=>u(s),children:[e.jsx(x,{className:"h-4 w-4 mr-1"}),"Set"]})]}):e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{type:"text",value:r.value||"",onChange:t=>d(s,t.target.value),className:"flex-1"}),e.jsxs(l,{size:"sm",variant:a?"default":"secondary",onClick:()=>u(s),children:[e.jsx(x,{className:"h-4 w-4 mr-1"}),"Set"]})]})};return R?e.jsx("div",{className:"container mx-auto py-8 px-4 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsxs("div",{className:"container mx-auto py-6 px-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(b,{className:"h-8 w-8"}),"Sandbox Configuration"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Configure sandbox environment settings"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(l,{asChild:!0,children:e.jsxs(O,{to:"/sandbox/mypnl",children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"My P&L"]})}),e.jsxs(l,{variant:"destructive",onClick:()=>j(!0),children:[e.jsx(S,{className:"h-4 w-4 mr-2"}),"Reset to Defaults"]})]})]}),e.jsx("div",{className:"space-y-6",children:Object.entries(i).map(([s,r])=>e.jsxs(B,{children:[e.jsx(V,{children:e.jsxs(W,{className:"flex items-center gap-2",children:[e.jsx(b,{className:"h-5 w-5 text-primary"}),r.title]})}),e.jsx(X,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:Object.entries(r.configs).map(([a,t])=>e.jsxs("div",{className:"space-y-2",children:[e.jsx(G,{htmlFor:a,className:"font-semibold",children:K(a)}),A(a,t),e.jsx("p",{className:"text-xs text-muted-foreground",children:t.description})]},a))})})]},s))}),e.jsx(q,{open:D,onOpenChange:j,children:e.jsxs(H,{children:[e.jsxs(U,{children:[e.jsxs(Y,{className:"flex items-center gap-2 text-destructive",children:[e.jsx(S,{className:"h-5 w-5"}),"Reset ALL Sandbox Data"]}),e.jsx(J,{asChild:!0,children:e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsx(z,{variant:"destructive",children:e.jsx(P,{children:"This action cannot be undone!"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"font-semibold",children:"This action will:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 ml-4 text-sm",children:[e.jsx("li",{children:"Delete all orders, trades, positions, and holdings"}),e.jsx("li",{children:"Reset funds to starting capital (1.00 Crore)"}),e.jsx("li",{children:"Reset all configuration values to defaults"}),e.jsx("li",{children:"Clear all historical data"})]})]}),e.jsx("p",{className:"text-muted-foreground",children:"Are you absolutely sure you want to reset everything?"})]})})]}),e.jsxs($,{children:[e.jsx(l,{variant:"ghost",onClick:()=>j(!1),children:"Cancel"}),e.jsx(l,{variant:"destructive",onClick:E,disabled:v,children:v?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-current mr-2"}),"Resetting..."]}):"Yes, Reset Everything"})]})]})})]})}export{ce as default};
