import{aw as W,r as a,j as e,x as K,ap as G,au as w,aP as U,F as X,at as $,bW as q,bX as J,t as d}from"./vendor-react-BtnKiOrb.js";import{p as g}from"./python-strategy-CDEXs7wP.js";import{B as x,e as M}from"./index-B87L8flj.js";import{C as b,b as F,c as D,d as k,a as A}from"./card-DaWziHEX.js";import{C as Q}from"./checkbox-BtMn2INA.js";import{D as V,b as Y,c as Z,d as ee,e as se,f as te}from"./dialog-B8y9YkxF.js";import{L as ae}from"./label-C7siTT_u.js";import{S as le}from"./scroll-area-DG1lJDzi.js";import{S as p}from"./skeleton-CrtzJpAL.js";function ge(){const{strategyId:r}=W(),[n,R]=a.useState(null),[m,j]=a.useState([]),[l,h]=a.useState(null),[o,N]=a.useState(null),[E,y]=a.useState(!0),[T,C]=a.useState(!1),[v,S]=a.useState(!1),[I,u]=a.useState(!1),[L,B]=a.useState(!0),c=a.useRef(null),_=async()=>{if(r)try{y(!0);const[s,t]=await Promise.all([g.getStrategy(r),g.getLogFiles(r)]);R(s),j(t),t.length>0&&!l&&h(t[0].name)}catch(s){console.error("Failed to fetch data:",s),d.error("Failed to load logs")}finally{y(!1)}},f=async s=>{if(r)try{C(!0);const t=await g.getLogContent(r,s);N(t),L&&c.current&&setTimeout(()=>{c.current&&(c.current.scrollTop=c.current.scrollHeight)},100)}catch(t){console.error("Failed to fetch log content:",t),d.error("Failed to load log content")}finally{C(!1)}};a.useEffect(()=>{_()},[]),a.useEffect(()=>{l&&f(l)},[l]),a.useEffect(()=>{if(n?.status==="running"&&l){const s=setInterval(()=>{f(l)},5e3);return()=>clearInterval(s)}},[n?.status,l]);const O=async()=>{if(r)try{S(!0);const s=await g.clearLogs(r);s.status==="success"?(d.success("Logs cleared"),j([]),h(null),N(null)):d.error(s.message||"Failed to clear logs")}catch(s){console.error("Failed to clear logs:",s),d.error("Failed to clear logs")}finally{S(!1),u(!1)}},P=s=>{const t=s.split("_");return t.length>1?t.slice(1).join("_").replace(".log",""):s.replace(".log","")},z=s=>s.split(`
`).map((t,H)=>{let i="text-gray-300";return t.includes("ERROR")||t.includes("error")||t.includes("Error")?i="text-red-400":t.includes("WARNING")||t.includes("warning")||t.includes("Warning")?i="text-yellow-400":t.includes("SUCCESS")||t.includes("success")||t.includes("Success")?i="text-green-400":(t.includes("INFO")||t.includes("info")||t.includes("Info"))&&(i="text-blue-400"),e.jsx("div",{className:i,children:t||" "},H)});return E?e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsx(p,{className:"h-8 w-32"}),e.jsxs("div",{className:"grid grid-cols-4 gap-6",children:[e.jsx(p,{className:"h-[600px]"}),e.jsx(p,{className:"h-[600px] col-span-3"})]})]}):n?e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsx(x,{variant:"ghost",asChild:!0,children:e.jsxs(K,{to:"/python",children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Back to Python Strategies"]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Strategy Logs"}),e.jsx("p",{className:"text-muted-foreground",children:n.name})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Q,{id:"auto-scroll",checked:L,onCheckedChange:s=>B(s)}),e.jsx(ae,{htmlFor:"auto-scroll",className:"text-sm",children:"Auto-scroll"})]}),e.jsxs(x,{variant:"outline",size:"sm",onClick:()=>l&&f(l),children:[e.jsx(w,{className:"h-4 w-4 mr-2"}),"Refresh"]}),e.jsxs(x,{variant:"destructive",size:"sm",onClick:()=>u(!0),disabled:m.length===0,children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Clear All"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsxs(b,{className:"lg:col-span-1",children:[e.jsxs(F,{children:[e.jsxs(D,{className:"text-sm flex items-center gap-2",children:[e.jsx(X,{className:"h-4 w-4"}),"Log Files"]}),e.jsxs(k,{children:[m.length," file(s)"]})]}),e.jsx(A,{children:m.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"No log files found"}):e.jsx(le,{className:"h-[500px]",children:e.jsx("div",{className:"space-y-2",children:m.map(s=>e.jsxs("button",{onClick:()=>h(s.name),className:`w-full text-left p-3 rounded-lg transition-colors ${l===s.name?"bg-primary text-primary-foreground":"bg-muted hover:bg-muted/80"}`,children:[e.jsx("div",{className:"font-medium text-sm truncate",children:P(s.name)}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-xs opacity-80",children:[e.jsx($,{className:"h-3 w-3"}),new Date(s.last_modified).toLocaleString("en-IN",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit"})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-xs opacity-80",children:[e.jsx(q,{className:"h-3 w-3"}),s.size_kb.toFixed(2)," KB"]})]},s.name))})})})]}),e.jsxs(b,{className:"lg:col-span-3",children:[e.jsxs(F,{children:[e.jsxs(D,{className:"text-sm flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-4 w-4"}),"Log Content"]}),n.status==="running"&&e.jsx(M,{className:"bg-green-500 animate-pulse",children:"Live"})]}),o&&e.jsxs(k,{children:[o.lines," lines • ",o.size_kb.toFixed(2)," KB • Last updated:"," ",new Date(o.last_updated).toLocaleString()]})]}),e.jsx(A,{children:l?T?e.jsx("div",{className:"flex items-center justify-center h-[500px]",children:e.jsx(w,{className:"h-6 w-6 animate-spin"})}):o?e.jsx("div",{ref:c,className:"h-[500px] overflow-auto bg-gray-900 rounded-lg p-4 font-mono text-xs",children:z(o.content)}):e.jsx("div",{className:"flex items-center justify-center h-[500px] text-muted-foreground",children:"No content available"}):e.jsx("div",{className:"flex items-center justify-center h-[500px] text-muted-foreground",children:"Select a log file to view its contents"})})]})]}),e.jsx(V,{open:I,onOpenChange:u,children:e.jsxs(Y,{children:[e.jsxs(Z,{children:[e.jsx(ee,{children:"Clear All Logs"}),e.jsxs(se,{children:['Are you sure you want to clear all log files for "',n.name,'"? This action cannot be undone.']})]}),e.jsxs(te,{children:[e.jsx(x,{variant:"outline",onClick:()=>u(!1),children:"Cancel"}),e.jsx(x,{variant:"destructive",onClick:O,disabled:v,children:v?"Clearing...":"Clear All Logs"})]})]})})]}):null}export{ge as default};
