import{r as t,t as d,j as e,x as K,ap as Q,b1 as U,bb as W,aG as X,am as Z,aP as $}from"./vendor-react-BtnKiOrb.js";import{a as A}from"./admin-C2knOC2Q.js";import{A as ee,b as se,c as ae,d as le,e as te,f as ie,g as de,h as ne}from"./alert-dialog-CN_Rec7D.js";import{B as n,e as m}from"./index-B87L8flj.js";import{C as u,a as g,b as re,c as ce,d as oe}from"./card-DaWziHEX.js";import{C as he}from"./checkbox-BtMn2INA.js";import{D as xe,b as me,c as je,d as ue,e as ge,f as pe}from"./dialog-B8y9YkxF.js";import{I}from"./input-fipynuSj.js";import{L as p}from"./label-C7siTT_u.js";import{S as w,a as L,b as E,c as Y,d as k}from"./select-Dmte1kG2.js";import{T as ye,a as fe,b as v,c as h,d as Ne,e as r}from"./table-CWVmNM6U.js";const De=[{value:"TRADING_HOLIDAY",label:"Trading Holiday"},{value:"SETTLEMENT_HOLIDAY",label:"Settlement Holiday"},{value:"SPECIAL_SESSION",label:"Special Session"}];function Ee(){const[c,O]=t.useState([]),[y,R]=t.useState([]),[b,F]=t.useState([]),[i,f]=t.useState(new Date().getFullYear()),[G,H]=t.useState(!0),[P,j]=t.useState(!1),[l,o]=t.useState({date:"",description:"",holiday_type:"TRADING_HOLIDAY",closed_exchanges:[]}),[C,S]=t.useState(!1),[x,N]=t.useState(null),[_,T]=t.useState(!1);t.useEffect(()=>{D(i)},[i]);const D=async s=>{H(!0);try{const a=await A.getHolidays(s);O(a.data),R(a.years),F(a.exchanges)}catch(a){console.error("Error fetching holidays:",a),d.error("Failed to load holidays")}finally{H(!1)}},B=async()=>{if(!l.date||!l.description){d.error("Please fill in date and description");return}if(l.holiday_type==="TRADING_HOLIDAY"&&l.closed_exchanges.length===0){d.error("Please select at least one exchange to close");return}S(!0);try{const s=await A.addHoliday({date:l.date,description:l.description,holiday_type:l.holiday_type,closed_exchanges:l.closed_exchanges});s.status==="success"?(d.success(s.message||"Holiday added successfully"),j(!1),o({date:"",description:"",holiday_type:"TRADING_HOLIDAY",closed_exchanges:[]}),D(i)):d.error(s.message||"Failed to add holiday")}catch(s){const a=s;d.error(a.response?.data?.message||"Failed to add holiday")}finally{S(!1)}},z=async()=>{if(x){T(!0);try{const s=await A.deleteHoliday(x.id);s.status==="success"?(d.success(s.message||"Holiday deleted successfully"),N(null),D(i)):d.error(s.message||"Failed to delete holiday")}catch(s){const a=s;d.error(a.response?.data?.message||"Failed to delete holiday")}finally{T(!1)}}},M=s=>{o(a=>({...a,closed_exchanges:a.closed_exchanges.includes(s)?a.closed_exchanges.filter(J=>J!==s):[...a.closed_exchanges,s]}))},V=()=>{o(s=>({...s,closed_exchanges:b}))},q=s=>{switch(s){case"TRADING_HOLIDAY":return e.jsx(m,{variant:"destructive",children:"Trading Holiday"});case"SETTLEMENT_HOLIDAY":return e.jsx(m,{variant:"secondary",children:"Settlement Holiday"});case"SPECIAL_SESSION":return e.jsx(m,{className:"bg-purple-500 hover:bg-purple-600",children:"Special Session"});default:return e.jsx(m,{variant:"outline",children:s})}};return G?e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsxs("div",{className:"py-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(K,{to:"/admin",className:"text-muted-foreground hover:text-foreground",children:e.jsx(Q,{className:"h-4 w-4"})}),e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(U,{className:"h-6 w-6"}),"Market Holidays"]})]}),e.jsx("p",{className:"text-muted-foreground",children:"Manage trading holidays for all supported exchanges"})]}),e.jsxs(n,{onClick:()=>j(!0),children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),"Add Holiday"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(u,{children:e.jsxs(g,{className:"p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold",children:c.length}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Total Holidays (",i,")"]})]})}),e.jsx(u,{children:e.jsxs(g,{className:"p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold",children:c.filter(s=>s.holiday_type==="TRADING_HOLIDAY").length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Trading Holidays"})]})}),e.jsx(u,{children:e.jsxs(g,{className:"p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold",children:c.filter(s=>s.holiday_type!=="TRADING_HOLIDAY").length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Special Days"})]})})]}),e.jsxs(u,{children:[e.jsxs(re,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ce,{children:"Holiday Calendar"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(n,{variant:"outline",size:"icon",onClick:()=>f(s=>s-1),disabled:!y.includes(i-1),children:e.jsx(X,{className:"h-4 w-4"})}),e.jsxs(w,{value:i.toString(),onValueChange:s=>f(parseInt(s,10)),children:[e.jsx(L,{className:"w-[120px]",children:e.jsx(E,{})}),e.jsx(Y,{children:y.map(s=>e.jsx(k,{value:s.toString(),children:s},s))})]}),e.jsx(n,{variant:"outline",size:"icon",onClick:()=>f(s=>s+1),disabled:!y.includes(i+1),children:e.jsx(Z,{className:"h-4 w-4"})})]})]}),e.jsxs(oe,{children:[c.length," holidays in ",i]})]}),e.jsx(g,{children:e.jsx("div",{className:"border rounded-md",children:e.jsxs(ye,{children:[e.jsx(fe,{children:e.jsxs(v,{children:[e.jsx(h,{children:"Date"}),e.jsx(h,{children:"Day"}),e.jsx(h,{children:"Description"}),e.jsx(h,{children:"Type"}),e.jsx(h,{children:"Closed Exchanges"}),e.jsx(h,{className:"w-[80px]",children:"Actions"})]})}),e.jsx(Ne,{children:c.length===0?e.jsx(v,{children:e.jsxs(r,{colSpan:6,className:"text-center text-muted-foreground py-8",children:["No holidays configured for ",i]})}):c.map(s=>e.jsxs(v,{children:[e.jsx(r,{className:"font-medium",children:s.date}),e.jsx(r,{children:s.day_name}),e.jsx(r,{children:s.description}),e.jsx(r,{children:q(s.holiday_type)}),e.jsx(r,{children:e.jsx("div",{className:"flex flex-wrap gap-1",children:s.closed_exchanges.length===0?e.jsx("span",{className:"text-muted-foreground text-sm",children:"-"}):s.closed_exchanges.map(a=>e.jsx(m,{variant:"outline",className:"text-xs",children:a},a))})}),e.jsx(r,{children:e.jsx(n,{size:"icon",variant:"ghost",className:"h-8 w-8 text-destructive hover:text-destructive",onClick:()=>N(s),children:e.jsx($,{className:"h-4 w-4"})})})]},s.id))})]})})})]}),e.jsx(xe,{open:P,onOpenChange:j,children:e.jsxs(me,{className:"max-w-md",children:[e.jsxs(je,{children:[e.jsx(ue,{children:"Add Holiday"}),e.jsx(ge,{children:"Add a new market holiday entry."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Date"}),e.jsx(I,{type:"date",value:l.date,onChange:s=>o({...l,date:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Description"}),e.jsx(I,{placeholder:"e.g., Republic Day",value:l.description,onChange:s=>o({...l,description:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Holiday Type"}),e.jsxs(w,{value:l.holiday_type,onValueChange:s=>o({...l,holiday_type:s}),children:[e.jsx(L,{children:e.jsx(E,{})}),e.jsx(Y,{children:De.map(s=>e.jsx(k,{value:s.value,children:s.label},s.value))})]})]}),l.holiday_type==="TRADING_HOLIDAY"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(p,{children:"Closed Exchanges"}),e.jsx(n,{variant:"link",size:"sm",className:"h-auto p-0",onClick:V,children:"Select All"})]}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:b.map(s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(he,{id:s,checked:l.closed_exchanges.includes(s),onCheckedChange:()=>M(s)}),e.jsx("label",{htmlFor:s,className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:s})]},s))})]})]}),e.jsxs(pe,{children:[e.jsx(n,{variant:"outline",onClick:()=>j(!1),children:"Cancel"}),e.jsx(n,{onClick:B,disabled:C,children:C?"Adding...":"Add Holiday"})]})]})}),e.jsx(ee,{open:!!x,onOpenChange:()=>N(null),children:e.jsxs(se,{children:[e.jsxs(ae,{children:[e.jsx(le,{children:"Delete Holiday?"}),e.jsxs(te,{children:['Are you sure you want to delete "',x?.description,'" on'," ",x?.date,"? This action cannot be undone."]})]}),e.jsxs(ie,{children:[e.jsx(de,{children:"Cancel"}),e.jsx(ne,{onClick:z,disabled:_,children:_?"Deleting...":"Delete"})]})]})})]})}export{Ee as default};
