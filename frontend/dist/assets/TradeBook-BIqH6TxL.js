import{r as l,j as e,ax as $,au as q,ad as Q,k as R,aA as M,L as X}from"./vendor-react-BtnKiOrb.js";import{t as K}from"./trading-B9xVcn7A.js";import{d as G,o as J,B as x,c as T,e as u,s as i}from"./index-B87L8flj.js";import{C as N,b as w,d as k,c as S,a as W}from"./card-DaWziHEX.js";import{D as Z,a as ee,b as se,c as ae,d as te,e as re,f as ne}from"./dialog-B8y9YkxF.js";import{L as D}from"./label-C7siTT_u.js";import{T as le,a as ie,b as U,c,d as ce,e as d}from"./table-CWVmNM6U.js";function z(o){return new Intl.NumberFormat("en-IN",{minimumFractionDigits:2}).format(o)}function de(o){try{return new Date(o).toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch{return o}}function pe(){const{apiKey:o}=G(),[b,P]=l.useState([]),[V,F]=l.useState(!0),[B,E]=l.useState(!1),[L,v]=l.useState(null),[t,I]=l.useState({action:[],exchange:[],product:[]}),[Y,O]=l.useState(!1),j=l.useMemo(()=>b.filter(s=>!(t.action.length>0&&!t.action.includes(s.action)||t.exchange.length>0&&!t.exchange.includes(s.exchange)||t.product.length>0&&!t.product.includes(s.product))),[b,t]),f=t.action.length>0||t.exchange.length>0||t.product.length>0,_=(s,a)=>{I(h=>{const g=h[s];return g.indexOf(a)>-1?{...h,[s]:g.filter(p=>p!==a)}:{...h,[s]:[...g,a]}})},y=()=>{I({action:[],exchange:[],product:[]})},m=l.useCallback(async(s=!1)=>{if(!o){F(!1);return}s&&E(!0);try{const a=await K.getTrades(o);a.status==="success"&&a.data?(P(a.data),v(null)):v(a.message||"Failed to fetch trades")}catch{v("Failed to fetch trades")}finally{F(!1),E(!1)}},[o]);l.useEffect(()=>{m();const s=setInterval(()=>m(),1e4);return()=>clearInterval(s)},[m]),l.useEffect(()=>{const s=J(()=>{m()});return()=>s()},[m]);const H=()=>{const s=["Symbol","Exchange","Product","Action","Qty","Price","Trade Value","Order ID","Time"],a=b.map(n=>[i(n.symbol),i(n.exchange),i(n.product),i(n.action),i(n.quantity),i(n.average_price),i(n.trade_value),i(n.orderid),i(n.timestamp)]),h=[s,...a].map(n=>n.join(",")).join(`
`),g=new Blob([h],{type:"text/csv"}),A=URL.createObjectURL(g),p=document.createElement("a");p.href=A,p.download=`tradebook_${new Date().toISOString().split("T")[0]}.csv`,p.click()},C={total:j.length,buyTrades:j.filter(s=>s.action==="BUY").length,sellTrades:j.filter(s=>s.action==="SELL").length},r=({type:s,value:a,label:h})=>e.jsx(x,{variant:t[s].includes(a)?"default":"outline",size:"sm",className:T("rounded-full",t[s].includes(a)&&"bg-pink-500 hover:bg-pink-600"),onClick:()=>_(s,a),children:h});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Trade Book"}),e.jsx("p",{className:"text-muted-foreground",children:"View your executed trades"})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs(Z,{open:Y,onOpenChange:O,children:[e.jsx(ee,{asChild:!0,children:e.jsxs(x,{variant:f?"default":"outline",size:"sm",className:"relative",children:[e.jsx($,{className:"h-4 w-4 mr-2"}),"Filters",f&&e.jsx("span",{className:"absolute -top-1 -right-1 w-2.5 h-2.5 bg-red-500 rounded-full"})]})}),e.jsxs(se,{className:"max-w-md",children:[e.jsxs(ae,{children:[e.jsx(te,{children:"Trade Filters"}),e.jsx(re,{children:"Filter trades by action, exchange, or product"})]}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(D,{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:"Action"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(r,{type:"action",value:"BUY",label:"Buy"}),e.jsx(r,{type:"action",value:"SELL",label:"Sell"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(D,{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:"Exchange"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(r,{type:"exchange",value:"NSE",label:"NSE"}),e.jsx(r,{type:"exchange",value:"BSE",label:"BSE"}),e.jsx(r,{type:"exchange",value:"NFO",label:"NFO"}),e.jsx(r,{type:"exchange",value:"BFO",label:"BFO"}),e.jsx(r,{type:"exchange",value:"MCX",label:"MCX"}),e.jsx(r,{type:"exchange",value:"CDS",label:"CDS"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(D,{className:"text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:"Product"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(r,{type:"product",value:"CNC",label:"CNC"}),e.jsx(r,{type:"product",value:"MIS",label:"MIS"}),e.jsx(r,{type:"product",value:"NRML",label:"NRML"})]})]})]}),e.jsxs(ne,{children:[e.jsx(x,{variant:"ghost",onClick:y,children:"Clear All"}),e.jsx(x,{onClick:()=>O(!1),children:"Done"})]})]})]}),e.jsxs(x,{variant:"outline",size:"sm",onClick:()=>m(!0),disabled:B,children:[e.jsx(q,{className:T("h-4 w-4 mr-2",B&&"animate-spin")}),"Refresh"]}),e.jsxs(x,{variant:"outline",size:"sm",onClick:H,children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Export"]})]})]}),f&&e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Active Filters:"}),t.action.map(s=>e.jsx(u,{variant:"secondary",className:"bg-pink-500/10 text-pink-600 border-pink-500/30",children:s},s)),t.exchange.map(s=>e.jsx(u,{variant:"secondary",className:"bg-pink-500/10 text-pink-600 border-pink-500/30",children:s},s)),t.product.map(s=>e.jsx(u,{variant:"secondary",className:"bg-pink-500/10 text-pink-600 border-pink-500/30",children:s},s)),e.jsx(x,{variant:"outline",size:"sm",className:"text-red-500 border-red-500/50 hover:bg-red-500/10",onClick:y,children:"Clear All"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsx(N,{children:e.jsxs(w,{className:"pb-2",children:[e.jsx(k,{children:"Total Trades"}),e.jsx(S,{className:"text-2xl",children:C.total})]})}),e.jsx(N,{children:e.jsxs(w,{className:"pb-2",children:[e.jsx(k,{children:"Buy Trades"}),e.jsxs(S,{className:"text-2xl text-green-600 flex items-center gap-2",children:[e.jsx(R,{className:"h-5 w-5"}),C.buyTrades]})]})}),e.jsx(N,{children:e.jsxs(w,{className:"pb-2",children:[e.jsx(k,{children:"Sell Trades"}),e.jsxs(S,{className:"text-2xl text-red-600 flex items-center gap-2",children:[e.jsx(M,{className:"h-5 w-5"}),C.sellTrades]})]})})]}),e.jsx(N,{children:e.jsx(W,{className:"p-0",children:V?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(X,{className:"h-8 w-8 animate-spin"})}):L?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:L}):j.length===0?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:f?e.jsxs("div",{children:[e.jsx("p",{className:"mb-4",children:"No trades match your filters"}),e.jsx(x,{variant:"ghost",size:"sm",onClick:y,children:"Clear Filters"})]}):"No trades today"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(le,{children:[e.jsx(ie,{children:e.jsxs(U,{children:[e.jsx(c,{children:"Symbol"}),e.jsx(c,{children:"Exchange"}),e.jsx(c,{children:"Product"}),e.jsx(c,{children:"Action"}),e.jsx(c,{className:"text-right",children:"Qty"}),e.jsx(c,{className:"text-right",children:"Price"}),e.jsx(c,{className:"text-right",children:"Trade Value"}),e.jsx(c,{children:"Order ID"}),e.jsx(c,{children:"Time"})]})}),e.jsx(ce,{children:j.map((s,a)=>e.jsxs(U,{children:[e.jsx(d,{className:"font-medium",children:s.symbol}),e.jsx(d,{children:e.jsx(u,{variant:"outline",children:s.exchange})}),e.jsx(d,{children:e.jsx(u,{variant:"secondary",children:s.product})}),e.jsx(d,{children:e.jsxs(u,{variant:s.action==="BUY"?"default":"destructive",className:T("gap-1",s.action==="BUY"?"bg-green-500":""),children:[s.action==="BUY"?e.jsx(R,{className:"h-3 w-3"}):e.jsx(M,{className:"h-3 w-3"}),s.action]})}),e.jsx(d,{className:"text-right font-mono",children:s.quantity}),e.jsx(d,{className:"text-right font-mono",children:z(s.average_price)}),e.jsx(d,{className:"text-right font-mono",children:z(s.trade_value)}),e.jsx(d,{className:"font-mono text-xs",children:s.orderid}),e.jsx(d,{className:"text-sm text-muted-foreground",children:de(s.timestamp)})]},`${s.orderid}-${a}`))})]})})})})]})}export{pe as default};
