import{aw as $,a0 as G,r as i,j as e,x as u,ap as Q,bI as K,aP as B,at as X,bd as Z,ag as j,aF as p,av as ee,bJ as se,a as te,v as ae,t as a,be as re,aA as ie,k as le}from"./vendor-react-BtnKiOrb.js";import{s as n}from"./strategy-qnBVQI5A.js";import{A as ne,b as ce,a as de}from"./alert-wYC2wlrk.js";import{B as r,e as m}from"./index-B87L8flj.js";import{C as f,b as y,c as N,d as v,a as b}from"./card-DaWziHEX.js";import{C as oe,b as xe,a as me}from"./collapsible-BCcK3_bH.js";import{D as he,b as ge,c as ue,d as je,e as pe,f as fe}from"./dialog-B8y9YkxF.js";import{S as ye}from"./separator-Cf28EULh.js";import{S as w}from"./skeleton-CrtzJpAL.js";import{T as Ne,a as ve,b as E,c,d as be,e as d}from"./table-CWVmNM6U.js";function Le(){const{strategyId:C}=$(),S=G(),[s,k]=i.useState(null),[o,T]=i.useState([]),[R,_]=i.useState(!0),[D,F]=i.useState(!1),[O,A]=i.useState(!1),[I,x]=i.useState(!1),[h,L]=i.useState(null),[M,P]=i.useState(!1),z=async()=>{if(C)try{_(!0);const t=await n.getStrategy(Number(C));k(t.strategy),T(t.mappings||[])}catch(t){console.error("Failed to fetch strategy:",t),a.error("Failed to load strategy"),S("/strategy")}finally{_(!1)}};i.useEffect(()=>{z()},[]);const g=async(t,l)=>{try{await navigator.clipboard.writeText(t),L(l),a.success("Copied to clipboard"),setTimeout(()=>L(null),2e3)}catch{a.error("Failed to copy")}},V=async()=>{if(s)try{F(!0);const t=await n.toggleStrategy(s.id);t.status==="success"?(k({...s,is_active:t.data?.is_active??!s.is_active}),a.success(t.data?.is_active?"Strategy activated":"Strategy deactivated")):a.error(t.message||"Failed to toggle strategy")}catch(t){console.error("Failed to toggle strategy:",t),a.error("Failed to toggle strategy")}finally{F(!1)}},W=async()=>{if(s)try{A(!0);const t=await n.deleteStrategy(s.id);t.status==="success"?(a.success("Strategy deleted successfully"),S("/strategy")):a.error(t.message||"Failed to delete strategy")}catch(t){console.error("Failed to delete strategy:",t),a.error("Failed to delete strategy")}finally{A(!1),x(!1)}},q=async t=>{if(s)try{const l=await n.deleteSymbolMapping(s.id,t);l.status==="success"?(T(o.filter(J=>J.id!==t)),a.success("Symbol mapping deleted")):a.error(l.message||"Failed to delete mapping")}catch(l){console.error("Failed to delete mapping:",l),a.error("Failed to delete mapping")}},Y=t=>{switch(t){case"LONG":return e.jsx(le,{className:"h-4 w-4 text-green-500"});case"SHORT":return e.jsx(ie,{className:"h-4 w-4 text-red-500"});case"BOTH":return e.jsx(re,{className:"h-4 w-4 text-blue-500"});default:return null}},U=t=>({tradingview:"TradingView",amibroker:"Amibroker",python:"Python",metatrader:"Metatrader",excel:"Excel",others:"Others"})[t]||t;if(R)return e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsx(w,{className:"h-8 w-32"}),e.jsx(w,{className:"h-48"}),e.jsx(w,{className:"h-64"})]});if(!s)return null;const H=n.getWebhookUrl(s.webhook_id);return e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsx(r,{variant:"ghost",asChild:!0,children:e.jsxs(u,{to:"/strategy",children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Back to Strategies"]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold tracking-tight flex items-center gap-3",children:[s.name,e.jsx(m,{variant:s.is_active?"default":"secondary",children:s.is_active?"Active":"Inactive"})]}),e.jsxs("p",{className:"text-muted-foreground",children:[U(s.platform)," â€¢ Created"," ",new Date(s.created_at).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(r,{variant:s.is_active?"outline":"default",onClick:V,disabled:D,children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),D?"Updating...":s.is_active?"Deactivate":"Activate"]}),e.jsxs(r,{variant:"destructive",onClick:()=>x(!0),children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(f,{children:[e.jsxs(y,{children:[e.jsx(N,{children:"Strategy Details"}),e.jsx(v,{children:"Configuration and settings"})]}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Status"}),e.jsx(m,{variant:s.is_active?"default":"secondary",className:"mt-1",children:s.is_active?"Active":"Inactive"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Type"}),e.jsx(m,{variant:"outline",className:"mt-1",children:s.is_intraday?"Intraday":"Positional"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Trading Mode"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[Y(s.trading_mode),e.jsx("span",{children:s.trading_mode})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Platform"}),e.jsx("p",{className:"mt-1",children:U(s.platform)})]})]}),s.is_intraday&&s.start_time&&e.jsxs(e.Fragment,{children:[e.jsx(ye,{}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-2 mb-2",children:[e.jsx(X,{className:"h-4 w-4"}),"Trading Hours"]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-sm",children:[e.jsxs("div",{className:"p-2 bg-muted rounded",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Start"}),e.jsx("p",{className:"font-mono",children:s.start_time})]}),e.jsxs("div",{className:"p-2 bg-muted rounded",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"End"}),e.jsx("p",{className:"font-mono",children:s.end_time})]}),e.jsxs("div",{className:"p-2 bg-muted rounded",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Square Off"}),e.jsx("p",{className:"font-mono",children:s.squareoff_time})]})]})]})]})]})]}),e.jsxs(f,{children:[e.jsxs(y,{children:[e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-5 w-5"}),"Webhook Configuration"]}),e.jsx(v,{children:"Use this URL to receive trading alerts"})]}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Webhook URL"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("code",{className:"flex-1 p-2 bg-muted rounded text-sm font-mono break-all",children:H}),e.jsx(r,{variant:"outline",size:"icon",onClick:()=>g(H,"url"),children:h==="url"?e.jsx(j,{className:"h-4 w-4 text-green-500"}):e.jsx(p,{className:"h-4 w-4"})})]})]}),s.platform!=="tradingview"&&e.jsxs(oe,{open:M,onOpenChange:P,children:[e.jsx(xe,{asChild:!0,children:e.jsxs(r,{variant:"ghost",className:"w-full justify-between",children:[e.jsx("span",{children:"Show Credentials"}),e.jsx(ee,{className:"h-4 w-4"})]})}),e.jsxs(me,{className:"space-y-3 mt-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Host URL"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("code",{className:"flex-1 p-2 bg-muted rounded text-sm font-mono",children:window.location.origin}),e.jsx(r,{variant:"outline",size:"icon",onClick:()=>g(window.location.origin,"host"),children:h==="host"?e.jsx(j,{className:"h-4 w-4 text-green-500"}):e.jsx(p,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Webhook ID"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("code",{className:"flex-1 p-2 bg-muted rounded text-sm font-mono",children:s.webhook_id}),e.jsx(r,{variant:"outline",size:"icon",onClick:()=>g(s.webhook_id,"webhook_id"),children:h==="webhook_id"?e.jsx(j,{className:"h-4 w-4 text-green-500"}):e.jsx(p,{className:"h-4 w-4"})})]})]})]})]}),s.platform==="tradingview"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-2",children:[e.jsx(se,{className:"h-4 w-4"}),"TradingView Alert Message Format"]}),e.jsx("pre",{className:"p-3 bg-muted rounded text-xs font-mono overflow-x-auto",children:`{
  "symbol": "{{ticker}}",
  "action": "BUY"
}`}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Use BUY, SELL, SHORT, or COVER for the action field."})]})]})]})]}),e.jsxs(ne,{children:[e.jsx(te,{className:"h-4 w-4"}),e.jsx(ce,{children:"Important Notes"}),e.jsx(de,{children:e.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1 text-sm",children:[e.jsxs("li",{children:["Orders are processed only when the strategy is ",e.jsx("strong",{children:"active"})]}),s.is_intraday&&e.jsxs("li",{children:["Orders are processed only during trading hours (",s.start_time," -"," ",s.end_time,")"]}),e.jsx("li",{children:"Symbol must be configured in the mappings below to receive orders"}),e.jsx("li",{children:"Use the correct action keywords: BUY, SELL, SHORT, COVER"}),s.trading_mode==="BOTH"&&e.jsxs("li",{children:["In BOTH mode, include ",e.jsx("code",{className:"bg-muted px-1 rounded",children:"position_size"})," ","in your JSON payload"]})]})})]}),e.jsxs(f,{children:[e.jsxs(y,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(N,{children:"Symbol Mappings"}),e.jsxs(v,{children:["Symbols configured for this strategy (",o.length," total)"]})]}),e.jsx(r,{asChild:!0,children:e.jsxs(u,{to:`/strategy/${s.id}/configure`,children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Configure Symbols"]})})]}),e.jsx(b,{children:o.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx("p",{children:"No symbols configured yet."}),e.jsx(r,{variant:"link",asChild:!0,children:e.jsx(u,{to:`/strategy/${s.id}/configure`,children:"Add your first symbol"})})]}):e.jsxs(Ne,{children:[e.jsx(ve,{children:e.jsxs(E,{children:[e.jsx(c,{children:"Symbol"}),e.jsx(c,{children:"Exchange"}),e.jsx(c,{className:"text-right",children:"Quantity"}),e.jsx(c,{children:"Product"}),e.jsx(c,{className:"w-16"})]})}),e.jsx(be,{children:o.map(t=>e.jsxs(E,{children:[e.jsx(d,{className:"font-medium",children:t.symbol}),e.jsx(d,{children:t.exchange}),e.jsx(d,{className:"text-right",children:t.quantity}),e.jsx(d,{children:e.jsx(m,{variant:"outline",children:t.product_type})}),e.jsx(d,{children:e.jsx(r,{variant:"ghost",size:"icon",className:"text-red-500 hover:text-red-600 hover:bg-red-50",onClick:()=>q(t.id),children:e.jsx(B,{className:"h-4 w-4"})})})]},t.id))})]})})]}),e.jsx(he,{open:I,onOpenChange:x,children:e.jsxs(ge,{children:[e.jsxs(ue,{children:[e.jsx(je,{children:"Delete Strategy"}),e.jsxs(pe,{children:['Are you sure you want to delete "',s.name,'"? This action cannot be undone. All symbol mappings will also be deleted.']})]}),e.jsxs(fe,{children:[e.jsx(r,{variant:"outline",onClick:()=>x(!1),children:"Cancel"}),e.jsx(r,{variant:"destructive",onClick:W,disabled:O,children:O?"Deleting...":"Delete Strategy"})]})]})})]})}export{Le as default};
