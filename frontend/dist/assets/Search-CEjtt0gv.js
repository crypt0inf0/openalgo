import{aE as D,r as a,j as e,x as H,s as $,aF as G,aG as K,am as O,t as T,aB as U}from"./vendor-react-BtnKiOrb.js";import{B as b,e as _}from"./index-B87L8flj.js";import{C as P,a as E}from"./card-DaWziHEX.js";import{S as Q,a as Z,b as J,c as W,d as X}from"./select-Dmte1kG2.js";import{T as Y,a as ee,b as v,d as se,e as l,c as te}from"./table-CWVmNM6U.js";const ae=[25,50,100,250,500,"all"];function oe(){const[i]=D(),[d,y]=a.useState([]),[R,C]=a.useState(!0),[m,B]=a.useState(null),[f,k]=a.useState("asc"),[o,S]=a.useState(1),[t,M]=a.useState(25);a.useEffect(()=>{F()},[]);const F=async()=>{C(!0);try{const s=new URLSearchParams,c=i.get("symbol"),x=i.get("exchange"),h=i.get("underlying"),u=i.get("expiry"),p=i.get("instrumenttype"),g=i.get("strike_min"),j=i.get("strike_max");c&&s.append("q",c),x&&s.append("exchange",x),h&&s.append("underlying",h),u&&s.append("expiry",u),p&&s.append("instrumenttype",p),g&&s.append("strike_min",g),j&&s.append("strike_max",j);const z=await fetch(`/search/api/search?${s.toString()}`,{credentials:"include"});if(z.ok){const A=await z.json();y(A.results||[])}else y([])}catch(s){console.error("Search error:",s),y([])}finally{C(!1)}},L=s=>{navigator.clipboard.writeText(s).then(()=>{T.success("Symbol copied to clipboard")}).catch(()=>{T.error("Failed to copy symbol")})},q=s=>{m===s?k(f==="asc"?"desc":"asc"):(B(s),k("asc"))},n=a.useMemo(()=>m?[...d].sort((s,c)=>{const x=s[m],h=c[m];if(["lotsize","token","freeze_qty"].includes(m)){const g=parseFloat(String(x??0).replace(/[^0-9.-]/g,""))||0,j=parseFloat(String(h??0).replace(/[^0-9.-]/g,""))||0;return f==="asc"?g-j:j-g}const u=String(x??""),p=String(h??"");return f==="asc"?u.localeCompare(p):p.localeCompare(u)}):d,[d,m,f]),w=a.useMemo(()=>{if(t==="all")return n;const s=(o-1)*t;return n.slice(s,s+t)},[n,o,t]),N=a.useMemo(()=>t==="all"?1:Math.ceil(n.length/t),[n.length,t]),I=t==="all"?1:(o-1)*t+1,V=t==="all"?n.length:Math.min(o*t,n.length),r=({column:s,label:c})=>e.jsx(te,{className:"cursor-pointer hover:bg-muted/50 select-none",onClick:()=>q(s),children:e.jsxs("div",{className:"flex items-center gap-1",children:[c,e.jsx(U,{className:"h-4 w-4 opacity-50"})]})});return R?e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsxs("div",{className:"py-6 space-y-6",children:[e.jsx(P,{children:e.jsxs(E,{className:"p-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-4",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Search Results"}),e.jsx(b,{asChild:!0,children:e.jsxs(H,{to:"/search/token",children:[e.jsx($,{className:"h-5 w-5 mr-2"}),"New Search"]})})]}),e.jsxs("div",{className:"inline-flex flex-col items-center bg-muted p-4 rounded-lg",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Found"}),e.jsx("div",{className:"text-3xl font-bold text-primary",children:d.length}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"matching symbols"})]})]})}),e.jsx(P,{children:e.jsx(E,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Y,{children:[e.jsx(ee,{children:e.jsxs(v,{children:[e.jsx(r,{column:"symbol",label:"Symbol"}),e.jsx(r,{column:"brsymbol",label:"Broker Symbol"}),e.jsx(r,{column:"name",label:"Name"}),e.jsx(r,{column:"exchange",label:"Exchange"}),e.jsx(r,{column:"brexchange",label:"Broker Exch"}),e.jsx(r,{column:"token",label:"Token"}),e.jsx(r,{column:"lotsize",label:"Lot Size"}),e.jsx(r,{column:"freeze_qty",label:"Freeze Qty"})]})}),e.jsx(se,{children:w.length===0?e.jsx(v,{children:e.jsx(l,{colSpan:8,className:"text-center py-8 text-muted-foreground",children:"No results found"})}):w.map((s,c)=>e.jsxs(v,{className:"hover:bg-muted/50",children:[e.jsx(l,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold",children:s.symbol}),e.jsx(b,{variant:"ghost",size:"icon",className:"h-6 w-6 opacity-60 hover:opacity-100",onClick:()=>L(s.symbol),title:"Copy symbol",children:e.jsx(G,{className:"h-3 w-3"})})]})}),e.jsx(l,{children:s.brsymbol}),e.jsx(l,{className:"text-muted-foreground max-w-[200px] truncate",children:s.name}),e.jsx(l,{children:e.jsx(_,{variant:"outline",children:s.exchange})}),e.jsx(l,{children:e.jsx(_,{variant:"secondary",children:s.brexchange})}),e.jsx(l,{className:"font-mono text-sm",children:s.token}),e.jsx(l,{children:s.lotsize??"-"}),e.jsx(l,{children:s.freeze_qty??"-"})]},c))})]})})})}),d.length>25&&e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",I," to ",V," of ",n.length," results"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{variant:"outline",size:"sm",onClick:()=>S(s=>Math.max(1,s-1)),disabled:o===1,children:e.jsx(K,{className:"h-4 w-4"})}),e.jsxs("span",{className:"text-sm px-2",children:["Page ",o," of ",N]}),e.jsx(b,{variant:"outline",size:"sm",onClick:()=>S(s=>Math.min(N,s+1)),disabled:o>=N,children:e.jsx(O,{className:"h-4 w-4"})})]}),e.jsxs(Q,{value:String(t),onValueChange:s=>{M(s==="all"?"all":Number(s)),S(1)},children:[e.jsx(Z,{className:"w-36",children:e.jsx(J,{})}),e.jsx(W,{children:ae.map(s=>e.jsx(X,{value:String(s),children:s==="all"?"Show All":`${s} per page`},s))})]})]})]})}export{oe as default};
